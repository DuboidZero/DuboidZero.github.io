<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physical Self-Perception Profile (PSPP)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .question-grid { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 1rem; width: 100%; }
        .statement-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .statement-group.left { align-items: flex-end; text-align: right; }
        .statement-group.right { align-items: flex-start; text-align: left; }
        .options { display: flex; gap: 1rem; align-items: center; }
        .options.left { flex-direction: row-reverse; }
        .separator { font-weight: 600; color: #4b5563; }
        input[type="radio"] { appearance: none; width: 1.25rem; height: 1.25rem; border: 2px solid #9ca3af; border-radius: 50%; cursor: pointer; transition: background-color 0.2s, border-color 0.2s; }
        input[type="radio"]:hover { border-color: #3b82f6; }
        input[type="radio"]:checked::before { content: ''; display: block; width: 0.75rem; height: 0.75rem; margin: 2px; background-color: #3b82f6; border-radius: 50%; }
        .question-card.incomplete { border: 1px solid #ef4444; box-shadow: 0 0 5px rgba(239, 68, 68, 0.5); }
        button:disabled { background-color: #9ca3af !important; cursor: not-allowed !important; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto max-w-4xl p-4 sm:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">Physical Self-Perception Profile</h1>
            <div class="flex justify-between items-center bg-white p-4 rounded-xl shadow-md mt-4 hidden" id="user-info-header">
                 <p>Logged in as: <span id="user-email-header" class="font-bold"></span></p>
                 <button id="logout-btn" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 text-sm">Logout</button>
            </div>
        </header>

        <!-- Auth Section -->
        <div id="auth-section" class="bg-white p-8 rounded-xl shadow-lg max-w-md mx-auto">
            <h2 class="text-2xl font-bold text-center mb-6">Participant Login</h2>
            <div id="auth-error" class="text-red-600 text-sm mb-4 text-center"></div>
            <!-- Email/Password Form -->
            <form id="email-form" class="space-y-4">
                <input type="email" id="email" placeholder="Email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <input type="password" id="password" placeholder="Password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <div class="flex flex-col sm:flex-row gap-2">
                    <button type="button" id="login-btn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Login</button>
                    <button type="button" id="register-btn" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700">Register</button>
                </div>
            </form>
            <div class="my-4 flex items-center before:flex-1 before:border-t before:border-gray-300 after:flex-1 after:border-t after:border-gray-300">
                <p class="text-center font-semibold mx-4">OR</p>
            </div>
            <!-- Google Sign-In Button -->
            <button id="google-signin-btn" class="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-50">
                <svg class="w-5 h-5" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.42-4.55H24v9.02h12.94c-.58 2.9-2.16 5.37-4.4 6.98l7.88 6.11C44.63 39.77 48 32.64 48 24c0-.73-.08-1.45-.22-2.16l-1.36-1.29z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.88-6.11c-2.11 1.41-4.78 2.27-7.91 2.27-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg>
                Sign in with Google
            </button>
        </div>

        <!-- Informed Consent Section -->
        <div id="consent-section" class="hidden bg-white p-8 rounded-xl shadow-lg max-w-2xl mx-auto">
             <h2 class="text-2xl font-bold text-center mb-6">Informed Consent Statement</h2>
             <div class="text-slate-700 space-y-4">
                <p>My name is Sailaja Inamdar, and I am currently pursuing a Master’s Degree in Psychology at Dr. Vishwanath Karad MIT World Peace University, Pune. I am conducting a survey to better understand the behaviour of individuals who attend the gym and those who do not.</p>
                <p>Your participation in this study is entirely voluntary. You may choose to withdraw at any time. The information you provide will be kept strictly confidential and will be used solely for educational purposes. No identifying details will be disclosed, and your responses will be reported only in aggregated form.</p>
                <p class="font-semibold">By proceeding to complete these questionnaires, you are indicating that you have read and understood the above information and that you voluntarily consent to participate in this survey.</p>
             </div>
             <div class="mt-8">
                <label class="flex items-center">
                    <input type="checkbox" id="consent-checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <span class="ml-3 text-slate-800">I have read, understood, and agree to participate.</span>
                </label>
             </div>
             <div class="mt-6 text-center">
                <button id="proceed-to-details-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700" disabled>Proceed</button>
             </div>
        </div>

        <!-- Personal Details Section -->
        <div id="details-section" class="hidden bg-white p-8 rounded-xl shadow-lg max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-center mb-6">Participant Information</h2>
            <form id="details-form" class="space-y-4">
                <div>
                    <label for="full-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                    <input type="text" id="full-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="age" class="block text-sm font-medium text-gray-700">Age</label>
                    <input type="number" id="age" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="gender" class="block text-sm font-medium text-gray-700">Gender</label>
                    <select id="gender" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                        <option value="">Select...</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                        <option value="Prefer not to say">Prefer not to say</option>
                    </select>
                </div>
                 <div>
                    <label for="education" class="block text-sm font-medium text-gray-700">Educational Background</label>
                    <input type="text" id="education" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                 <div>
                    <label for="location" class="block text-sm font-medium text-gray-700">Location</label>
                    <input type="text" id="location" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                 <div>
                    <label for="gym-status" class="block text-sm font-medium text-gray-700">Which of these best describes you?</label>
                    <select id="gym-status" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                        <option value="">Select...</option>
                        <option value="Gym-goer">Gym-goer</option>
                        <option value="Non-Gym-goer">Non-Gym-goer</option>
                    </select>
                </div>
                <div id="gym-experience-container" class="hidden">
                    <label for="gym-experience" class="block text-sm font-medium text-gray-700">How long have you been attending the gym? (e.g., 1 year, 2 months)</label>
                    <input type="text" id="gym-experience" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                 <div class="mt-6 text-center">
                    <button type="button" id="proceed-to-survey-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700">Next</button>
                 </div>
            </form>
        </div>
        
        <!-- Main Survey Section -->
        <div id="survey-wrapper" class="hidden">
            <div id="survey-container">
                <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg mb-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-4">Instructions</h2>
                    <p class="mb-2">These are statements that allow people to describe themselves. There are no right or wrong answers since people differ a lot.</p>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700">
                        <li>For each item, read the two opposing statements.</li>
                        <li>First, decide which one of the two statements best describes you.</li>
                        <li>Then, go to that side of the statement and check if it is <span class="font-semibold">"Sort of True for Me"</span> or <span class="font-semibold">"Really True for Me"</span>.</li>
                        <li>Please select only ONE of the four options for each item.</li>
                    </ol>
                </div>
                <form id="pspp-form">
                    <div id="pspp-questions-container" class="space-y-6"><h2 class="text-2xl font-bold text-center text-slate-900 border-b pb-2">What Am I Like? (PSPP)</h2></div>
                    <div id="pip-questions-container" class="space-y-6 mt-12"><h2 class="text-2xl font-bold text-center text-slate-900 border-b pb-2">How Important Are Things To You? (PIP)</h2></div>
                    <div class="mt-10 text-center"><button type="button" id="submit-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-blue-700 w-full sm:w-auto">Submit</button></div>
                </form>
            </div>
            <div id="thank-you-section" class="hidden text-center bg-white p-10 rounded-xl shadow-lg mt-8">
                <h2 class="text-3xl font-bold text-green-600 mb-4">Thank You!</h2>
                <p class="text-slate-700 text-lg">Your response has been recorded successfully.</p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // --- FIREBASE SETUP ---
        const firebaseConfig = {
            apiKey: "AIzaSyAg-Wjof_J2AHPp44f6sPKhEckWwowuDUM",
            authDomain: "pspp-b879f.firebaseapp.com",
            projectId: "pspp-b879f",
            storageBucket: "pspp-b879f.firebasestorage.app",
            messagingSenderId: "252651291932",
            appId: "1:252651291932:web:1d25e7b3f955ee606d66d9",
            measurementId: "G-BLBS4RG34S"
    };
        
        // This line makes it compatible with environments that might inject the config dynamically.
        const finalFirebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-pspp-app';

        // --- IMPORT FIREBASE MODULES ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // --- INITIALIZE FIREBASE ---
        const app = initializeApp(finalFirebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // --- DOM ELEMENTS ---
        const authSection = document.getElementById('auth-section');
        const consentSection = document.getElementById('consent-section');
        const detailsSection = document.getElementById('details-section');
        const surveyWrapper = document.getElementById('survey-wrapper');
        const userInfoHeader = document.getElementById('user-info-header');
        const userEmailHeaderSpan = document.getElementById('user-email-header');
        const authError = document.getElementById('auth-error');
        const consentCheckbox = document.getElementById('consent-checkbox');
        const proceedToDetailsBtn = document.getElementById('proceed-to-details-btn');
        const proceedToSurveyBtn = document.getElementById('proceed-to-survey-btn');
        const gymStatusSelect = document.getElementById('gym-status');
        const gymExperienceContainer = document.getElementById('gym-experience-container');
        const gymExperienceInput = document.getElementById('gym-experience');

        // --- AUTH STATE LISTENER ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userEmailHeaderSpan.textContent = user.email;
                authSection.classList.add('hidden');
                userInfoHeader.classList.remove('hidden');
                consentSection.classList.remove('hidden');
            } else {
                authSection.classList.remove('hidden');
                userInfoHeader.classList.add('hidden');
                consentSection.classList.add('hidden');
                detailsSection.classList.add('hidden');
                surveyWrapper.classList.add('hidden');
            }
        });

        // --- AUTH EVENT HANDLERS ---
        document.getElementById('register-btn').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            authError.textContent = '';
            try {
                await createUserWithEmailAndPassword(auth, email, password);
            } catch (error) {
                authError.textContent = error.message;
            }
        });

        document.getElementById('login-btn').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            authError.textContent = '';
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                authError.textContent = error.message;
            }
        });

        document.getElementById('google-signin-btn').addEventListener('click', async () => {
            authError.textContent = '';
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                authError.textContent = error.message;
            }
        });

        document.getElementById('logout-btn').addEventListener('click', async () => {
            await signOut(auth);
        });

        // --- PAGE NAVIGATION LOGIC ---
        consentCheckbox.addEventListener('change', () => {
            proceedToDetailsBtn.disabled = !consentCheckbox.checked;
        });

        proceedToDetailsBtn.addEventListener('click', () => {
            consentSection.classList.add('hidden');
            detailsSection.classList.remove('hidden');
        });

        proceedToSurveyBtn.addEventListener('click', () => {
            const detailsForm = document.getElementById('details-form');
            if (detailsForm.checkValidity()) {
                detailsSection.classList.add('hidden');
                surveyWrapper.classList.remove('hidden');
            } else {
                detailsForm.reportValidity();
            }
        });

        gymStatusSelect.addEventListener('change', () => {
            if (gymStatusSelect.value === 'Gym-goer') {
                gymExperienceContainer.classList.remove('hidden');
                gymExperienceInput.required = true;
            } else {
                gymExperienceContainer.classList.add('hidden');
                gymExperienceInput.required = false;
                gymExperienceInput.value = '';
            }
        });


        // --- DATA AND SCORING CONFIG (Unchanged) ---
        const psppQuestions = [ { id: 1, left: "Some people feel that they are not very good when it comes to playing sports.", right: "Others feel that they are really good at just about every sport." }, { id: 2, left: "Some people are not very confident about their level of physical conditioning and fitness.", right: "Others always feel confident that they maintain excellent conditioning and fitness." }, { id: 3, left: "Some people feel that compared to most, they have an attractive body.", right: "Others feel that compared to most, their body is not quite so attractive." }, { id: 4, left: "Some people feel that they are physically stronger than most people of their sex.", right: "Others feel that they lack physical strength compared to most others of their sex." }, { id: 5, left: "Some people feel extremely proud of who they are and what they can do physically.", right: "Others are sometimes not quite so proud of who they are physically." }, { id: 6, left: "Some people feel that they are among the best when it comes to athletic ability.", right: "Others feel that they are not among the most able when it comes to athletics." }, { id: 7, left: "Some people make certain they take part in some form of regular vigorous physical exercise.", right: "Others don’t often manage to keep up regular vigorous physical exercise." }, { id: 8, left: "Some people feel that they have difficulty maintaining an attractive body.", right: "Others feel that they are easily able to keep their bodies looking attractive." }, { id: 9, left: "Some people feel that their muscles are much stronger than most others of their sex.", right: "Others feel that on the whole their muscles are not quite so strong as most others of their sex." }, { id: 10, left: "Some people are sometimes not so happy with the way they are or what they can do physically.", right: "Others always feel happy about the kind of person they are physically." }, { id: 11, left: "Some people are not quite so confident when it comes to taking part in sports activities.", right: "Others are among the most confident when it comes to taking part in sports activities." }, { id: 12, left: "Some people do not usually have a high level of stamina and fitness.", right: "Others always maintain a high level of stamina and fitness." }, { id: 13, left: "Some people feel embarrassed by their bodies when it comes to wearing few clothes.", right: "Others do not feel embarrassed by their bodies when it comes wearing few clothes." }, { id: 14, left: "When it comes to situations requiring strength some people are one of the first to step forward.", right: "When it comes to situations requiring strength some people are one of the last to step forward." }, { id: 15, left: "When it comes to the physical side of themselves some people do not feel very confident.", right: "Others seem to have a real sense of confidence in the physical side of themselves." }, { id: 16, left: "Some people feel that they are always one of the best when it comes to joining in sports activities.", right: "Others feel that they are not one of the best when it comes to joining in sports activities." }, { id: 17, left: "Some people tend to feel a little uneasy in fitness and exercise settings.", right: "Others feel confident and at ease at all times in fitness and exercise settings." }, { id: 18, left: "Some people feel that they are often admired because their physique or figure is considered attractive.", right: "Others rarely feel that they receive admiration for the way their body looks." }, { id: 19, left: "Some people tend to lack confidence when it comes to their physical strength.", right: "Others are extremely confident when it comes to their physical strength." }, { id: 20, left: "Some people always have a real positive feeling about the physical side of themselves.", right: "Others sometimes do not feel positive about the physical side of themselves." }, { id: 21, left: "Some people are sometimes a little slower than most when it comes to learning new skills in a sports situation.", right: "Others have always seemed to be among the quickest when it comes to learning new sports skills." }, { id: 22, left: "Some people feel extremely confident about their ability to maintain regular exercise and physical condition.", right: "Others don’t feel quite so confident about their ability to maintain regular exercise and physical condition." }, { id: 23, left: "Some people feel that compared to most, their bodies do not look in the best of shape.", right: "Others feel that compared to most their bodies always look in excellent physical shape." }, { id: 24, left: "Some people feel that they are very strong and have well developed muscles compared to most people.", right: "Others feel that they are not so strong and their muscles are not very well developed." }, { id: 25, left: "Some people wish that they could have more respect for their physical selves.", right: "Others always have great respect for their physical selves." }, { id: 26, left: "Given the chance, some people are always one of the first to join in sports activities.", right: "Other people sometimes hold back and are not usually among the first to join in sports." }, { id: 27, left: "Some people feel that compared to most they always maintain a high level of physical conditioning.", right: "Others feel that compared to most their level of physical conditioning is not usually so high." }, { id: 28, left: "Some people are extremely confident about the appearance of their body.", right: "Others are a little self-conscious about the appearance of their bodies." }, { id: 29, left: "Some people feel that they are not as good as most at dealing with situations requiring physical strength.", right: "Others feel that they are among the best at dealing with situations which require physical strength." }, { id: 30, left: "Some people feel extremely satisfied with the kind of person they are physically.", right: "Others sometimes feel a little dissatisfied with their physical selves." } ];
        const pipQuestions = [ { id: 1, left: "Some people feel that being good at sports is vitally important to them.", right: "Others feel that being good at sports is not so important to them." }, { id: 2, left: "Some people do not feel that maintaining a high level of physical conditioning is very important to them.", right: "Others feel that maintaining a high level of physical conditioning is extremely important to them." }, { id: 3, left: "Some people believe that having an attractive physique or figure is vitally important to them.", right: "Others believe that having an attractive physique or figure is not all that important in their lives." }, { id: 4, left: "Some people believe that being physically strong is not so important to them.", right: "Others feel that it is extremely important to them to be physically strong." }, { id: 5, left: "Some people feel that having very good sports ability and skill is not so important to them.", right: "Others feel that having a high level of sports ability is really important to them." }, { id: 6, left: "Some people feel that maintaining regular vigorous exercise is vitally important to them.", right: "Others feel that keeping up regular vigorous exercise is not of prime importance to them." }, { id: 7, left: "Some people do not feel it so important to them to spend a lot of time and effort maintaining an attractive body.", right: "Others think that it is vitally important to spend time and effort maintaining an attractive body." }, { id: 8, left: "Some people feel that being strong and having well developed/toned muscles is vitally important to them.", right: "Others feel that being strong and having well developed/toned muscles is not so important to them." } ];
        const scoring = { pspp: { scales: { 'Sport Competence': [1, 6, 11, 16, 21, 26], 'Physical Condition': [2, 7, 12, 17, 22, 27], 'Body Attractiveness': [3, 8, 13, 18, 23, 28], 'Physical Strength': [4, 9, 14, 19, 24, 29], 'Physical Self-Worth (Global)': [5, 10, 15, 20, 25, 30] }, reverseScoredItems: [3, 4, 5, 6, 7, 9, 14, 16, 18, 20, 22, 24, 26, 27, 28, 30] }, pip: { scales: { 'Sport Importance': [1, 5], 'Condition Importance': [2, 6], 'Body Importance': [3, 7], 'Strength Importance': [4, 8] }, reverseScoredItems: [1, 3, 6, 8] } };

        // --- RENDER QUESTIONS DYNAMICALLY ---
        function createQuestionHTML(q, prefix, reverseScoredItems) {
            const isReverse = reverseScoredItems.includes(q.id);
            const leftScores = isReverse ? [4, 3] : [1, 2];
            const rightScores = isReverse ? [2, 1] : [3, 4];
            const name = `${prefix}q${q.id}`;

            return `
                <div class="question-card bg-white p-4 sm:p-5 rounded-lg shadow-sm border border-slate-200" id="card-${name}">
                    <div class="question-grid">
                        <div class="statement-group left">
                            <span class="text-sm sm:text-base">${q.left}</span>
                            <div class="options left mt-2">
                                <label for="${name}-${leftScores[1]}" class="cursor-pointer text-xs sm:text-sm text-slate-600">Sort of True</label>
                                <input type="radio" id="${name}-${leftScores[1]}" name="${name}" value="${leftScores[1]}">
                                <label for="${name}-${leftScores[0]}" class="cursor-pointer text-xs sm:text-sm text-slate-600">Really True</label>
                                <input type="radio" id="${name}-${leftScores[0]}" name="${name}" value="${leftScores[0]}">
                            </div>
                        </div>
                        <div class="separator">BUT</div>
                        <div class="statement-group right">
                            <span class="text-sm sm:text-base">${q.right}</span>
                             <div class="options right mt-2">
                                <input type="radio" id="${name}-${rightScores[0]}" name="${name}" value="${rightScores[0]}">
                                <label for="${name}-${rightScores[0]}" class="cursor-pointer text-xs sm:text-sm text-slate-600">Sort of True</label>
                                <input type="radio" id="${name}-${rightScores[1]}" name="${name}" value="${rightScores[1]}">
                                <label for="${name}-${rightScores[1]}" class="cursor-pointer text-xs sm:text-sm text-slate-600">Really True</label>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        document.addEventListener('DOMContentLoaded', () => { const psppContainer = document.getElementById('pspp-questions-container'); const pipContainer = document.getElementById('pip-questions-container'); psppQuestions.forEach(q => { psppContainer.innerHTML += createQuestionHTML(q, 'pspp', scoring.pspp.reverseScoredItems); }); pipQuestions.forEach(q => { pipContainer.innerHTML += createQuestionHTML(q, 'pip', scoring.pip.reverseScoredItems); }); document.getElementById('submit-btn').addEventListener('click', handleSubmit); });
        
        // --- FORM SUBMISSION & DATA HANDLING ---
        async function handleSubmit() {
            const submitBtn = document.getElementById('submit-btn');
            const form = document.getElementById('pspp-form');
            
            document.querySelectorAll('.question-card').forEach(card => card.classList.remove('incomplete'));

            let allAnswered = true; const answers = { pspp: {}, pip: {} };
            for (let i = 1; i <= 30; i++) { const radios = form.elements[`psppq${i}`]; if (radios && radios.value) { answers.pspp[`q${i}`] = parseInt(radios.value, 10); } else { allAnswered = false; document.getElementById(`card-psppq${i}`).classList.add('incomplete'); } }
            for (let i = 1; i <= 8; i++) { const radios = form.elements[`pipq${i}`]; if (radios && radios.value) { answers.pip[`q${i}`] = parseInt(radios.value, 10); } else { allAnswered = false; document.getElementById(`card-pipq${i}`).classList.add('incomplete'); } }

            if (!allAnswered) {
                alert('Please answer all questions. Unanswered questions are highlighted in red.');
                const firstIncomplete = document.querySelector('.incomplete');
                if (firstIncomplete) {
                    firstIncomplete.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return;
            }
            
            submitBtn.disabled = true; submitBtn.textContent = 'Saving...';

            const finalScores = {};
            for (const [scaleName, questionIds] of Object.entries(scoring.pspp.scales)) { finalScores[scaleName] = questionIds.reduce((sum, id) => sum + answers.pspp[`q${id}`], 0); }
            for (const [scaleName, questionIds] of Object.entries(scoring.pip.scales)) { finalScores[scaleName] = questionIds.reduce((sum, id) => sum + answers.pip[`q${id}`], 0); }
            
            const gymStatus = document.getElementById('gym-status').value;
            const personalDetails = {
                fullName: document.getElementById('full-name').value,
                age: document.getElementById('age').value,
                gender: document.getElementById('gender').value,
                education: document.getElementById('education').value,
                location: document.getElementById('location').value,
                gymStatus: gymStatus,
                gymExperience: gymStatus === 'Gym-goer' ? document.getElementById('gym-experience').value : 'N/A'
            };

            const user = auth.currentUser;
            if (!user) {
                alert('Error: You are not logged in. Please refresh and log in again.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit';
                return;
            }

            try {
                const userDoc = { 
                    personalDetails: personalDetails,
                    scores: finalScores, 
                    individualAnswers: answers, 
                    submittedAt: serverTimestamp(), 
                    userEmail: user.email 
                };
                const docRef = await addDoc(collection(db, `artifacts/${appId}/users/${user.uid}/responses`), userDoc);
                console.log("Document written with ID: ", docRef.id);
                
                document.getElementById('survey-wrapper').classList.add('hidden');
                document.getElementById('thank-you-section').classList.remove('hidden');

            } catch (e) {
                console.error("Error adding document: ", e);
                alert('Error: Could not save your response. Please check your internet connection and try again.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit';
            }
        }
    </script>
</body>
</html>

